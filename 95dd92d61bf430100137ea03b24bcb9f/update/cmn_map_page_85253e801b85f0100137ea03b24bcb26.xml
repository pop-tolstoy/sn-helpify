<?xml version="1.0" encoding="UTF-8"?><record_update table="cmn_map_page">
    <cmn_map_page action="INSERT_OR_UPDATE">
        <center_address>17.3810,78.45968</center_address>
        <center_latitude>17.3819542</center_latitude>
        <center_longitude>78.4601153</center_longitude>
        <controls_size>large</controls_size>
        <coordinates_retrieved_on/>
        <disable_map_controls/>
        <disable_nav_bar>false</disable_nav_bar>
        <filter/>
        <initial_zoom>11</initial_zoom>
        <name>x_643435_demoapp_Nearby Users</name>
        <overview>false</overview>
        <refresh_on_zoom>false</refresh_on_zoom>
        <roles/>
        <script><![CDATA[function distance(lat1, lon1, lat2, lon2) {
    if ((lat1 == lat2) && (lon1 == lon2)) {
        return 0;
    } else {
        var radlat1 = Math.PI * lat1 / 180;
        var radlat2 = Math.PI * lat2 / 180;
        var theta = lon1 - lon2;
        var radtheta = Math.PI * theta / 180;
        var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
        if (dist > 1) {
            dist = 1;
        }
        dist = Math.acos(dist);
        dist = dist * 180 / Math.PI;
        dist = dist * 60 * 1.1515;
        dist = dist * 1.609344;

        return dist;
    }
}
//var la2=0.00; var lo2=0.00;
//var grr=new GlideRecord("sys_user");
var userid = gs.getUserID();
//Console.log(ui);
//gs.info("this is user-"+ ui.sys_id + "");
//gs.info("this is user-"+ ui+ "");
/*grr.query();
while(grr.next())
{
 if(grr.sys_id==ui) {la2=grr.latitude;  lo2=grr.longitude;}
}*/
var gt = new GlideRecord("sys_user");
gt.get(userid);
//gs.info("this is user-" + gt.first_name + "");
var lt2 = gt.latitude;
var lo2 = gt.longitude;
var gr = new GlideRecord("sys_user");
gr.query();
while (gr.next()) {
    if (gr.latitude && gr.longitude && gr.x_643435_demoapp_is_available) {
        var lt1 = gr.latitude;
        var lo1 = gr.longitude;
        var dis = distance(lt1, lo1, lt2, lo2);
		//gs.info(""+gr.first_name+dis +"");
		if(dis<=30)
			{
            var item = map.addItem(gr);
            item.latitude = String(gr.latitude);
            item.longitude = String(gr.longitude);
            item.dialog_title = gr.getDisplayValue();
				if(!dis)
            item.icon = "https://maps.google.com/mapfiles/kml/pal3/icon48.png";
					//item.icon="http://maps.gstatic.com/mapfiles/ms2/micons/green.png";
			//item.marker_label=dis;
				//item.marker_click_action=distance();
            item.icon_width = "32";
            item.icon_height = "32";
			}
    }

}]]></script>
        <show_device_location>true</show_device_location>
        <suffix>Nearby Users</suffix>
        <sys_class_name>cmn_map_page</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2021-06-25 05:47:55</sys_created_on>
        <sys_id>85253e801b85f0100137ea03b24bcb26</sys_id>
        <sys_mod_count>27</sys_mod_count>
        <sys_name>x_643435_demoapp_Nearby Users</sys_name>
        <sys_package display_value="demoapp" source="x_643435_demoapp">95dd92d61bf430100137ea03b24bcb9f</sys_package>
        <sys_policy/>
        <sys_scope display_value="demoapp">95dd92d61bf430100137ea03b24bcb9f</sys_scope>
        <sys_update_name>cmn_map_page_85253e801b85f0100137ea03b24bcb26</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2021-07-05 06:47:11</sys_updated_on>
        <type>normal</type>
        <type_selection>buttons</type_selection>
        <use_advanced_configuration>false</use_advanced_configuration>
    </cmn_map_page>
</record_update>
